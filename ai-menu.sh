#!/bin/bash
# AI Coder Menu v2.0 - —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π –º–æ–¥–µ–ª–µ–π

MODELS_DIR="models"
OLLAMA_MODELS_DIR="$HOME/.ollama/models"

# –°–æ–∑–¥–∞—ë–º –ø–∞–ø–∫—É –¥–ª—è –º–æ–¥–µ–ª–µ–π –µ—Å–ª–∏ –Ω–µ—Ç
mkdir -p "$MODELS_DIR"

# –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ª–∏ –º–æ–¥–µ–ª—å
check_model() {
    local model_name=$1
    if ollama list | grep -q "$model_name"; then
        return 0  # –º–æ–¥–µ–ª—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
    else
        return 1  # –º–æ–¥–µ–ª—å –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
    fi
}

# –§—É–Ω–∫—Ü–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –º–æ–¥–µ–ª–∏
install_model() {
    local model_name=$1
    echo "üì• –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é $model_name..."
    echo "–≠—Ç–æ –∑–∞–π–º—ë—Ç –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è..."
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –º–æ–¥–µ–ª—å –≤ –Ω–∞—à—É –ø–∞–ø–∫—É —á–µ—Ä–µ–∑ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫—É—é —Å—Å—ã–ª–∫—É
    ollama pull "$model_name"
    
    if [ $? -eq 0 ]; then
        echo "‚úÖ $model_name —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞!"
        return 0
    else
        echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ $model_name"
        return 1
    fi
}

# –§—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –º–æ–¥–µ–ª–∏
run_model() {
    local model_name=$1
    local description=$2
    
    echo ""
    echo "ü§ñ $description"
    echo "‚ö° –ú–æ–¥–µ–ª—å: $model_name"
    
    if check_model "$model_name"; then
        echo "‚úÖ –ú–æ–¥–µ–ª—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞, –∑–∞–ø—É—Å–∫–∞—é..."
        echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
        ollama run "$model_name"
    else
        echo "‚ùå –ú–æ–¥–µ–ª—å –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞!"
        echo ""
        read -p "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ–π—á–∞—Å? (y/n): " -n 1 -r
        echo
        if [[ $REPLY =~ ^[Yy]$ ]]; then
            install_model "$model_name"
            if [ $? -eq 0 ]; then
                echo "üöÄ –ó–∞–ø—É—Å–∫–∞—é –º–æ–¥–µ–ª—å..."
                echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
                ollama run "$model_name"
            fi
        else
            echo "‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —ç—Ç—É –º–æ–¥–µ–ª—å"
            read -p "–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è..."
        fi
    fi
}

# –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
main_menu() {
    while true; do
        clear
        echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
        echo "‚ïë         ü§ñ AI CODER MENU v2.0         ‚ïë"
        echo "‚ïë    —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π –º–æ–¥–µ–ª–µ–π  ‚ïë"
        echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
        echo ""
        echo "üöÄ –ó–ê–ü–£–°–¢–ò–¢–¨ –ú–û–î–ï–õ–¨:"
        echo ""
        echo "1. DeepSeek-Coder 1.3B ‚ö°‚ö°‚ö°‚ö°‚ö°"
        echo "   (—Å–∞–º–∞—è –±—ã—Å—Ç—Ä–∞—è, –¥–ª—è –Ω–∞—á–∞–ª–∞)"
        echo ""
        echo "2. DeepSeek-Coder 6.7B ‚ö°‚ö°‚ö°"
        echo "   (–±–∞–ª–∞–Ω—Å —Å–∫–æ—Ä–æ—Å—Ç–∏/–∫–∞—á–µ—Å—Ç–≤–∞)"
        echo ""
        echo "3. Qwen2.5-Coder 7B ‚ö°‚ö°"
        echo "   (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è, 20+ —è–∑—ã–∫–æ–≤)"
        echo ""
        echo "4. CodeLlama 7B ‚ö°‚ö°‚ö°"
        echo "   (–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è, –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω–∞—è)"
        echo ""
        echo "5. Codestral ‚ö°‚ö°‚ö°"
        echo "   (–æ—Ç Mistral AI, —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è)"
        echo ""
        echo "üîß –£–ü–†–ê–í–õ–ï–ù–ò–ï:"
        echo ""
        echo "6. üì¶ –ü–æ–∫–∞–∑–∞—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏"
        echo "7. üì• –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –º–æ–¥–µ–ª–∏"
        echo "8. üóëÔ∏è  –£–¥–∞–ª–∏—Ç—å –º–æ–¥–µ–ª—å"
        echo "9. üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏—Å—Ç–µ–º—É"
        echo "0. üö™ –í—ã—Ö–æ–¥"
        echo ""
        
        read -p "–í—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç [0-9]: " choice
        
        case $choice in
            1)
                run_model "deepseek-coder:1.3b" "DeepSeek-Coder 1.3B - —Å–∞–º–∞—è –±—ã—Å—Ç—Ä–∞—è –º–æ–¥–µ–ª—å"
                ;;
            2)
                run_model "deepseek-coder:6.7b" "DeepSeek-Coder 6.7B - –æ—Ç–ª–∏—á–Ω—ã–π –±–∞–ª–∞–Ω—Å"
                ;;
            3)
                run_model "qwen2.5-coder:7b" "Qwen2.5-Coder 7B - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å"
                ;;
            4)
                run_model "codellama:7b" "CodeLlama 7B - –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å"
                ;;
            5)
                run_model "codestral:latest" "Codestral - –æ—Ç Mistral AI"
                ;;
            6)
                clear
                echo "üì¶ –£–°–¢–ê–ù–û–í–õ–ï–ù–ù–´–ï –ú–û–î–ï–õ–ò:"
                echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
                ollama list
                echo ""
                echo "üí° –ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —á–µ—Ä–µ–∑ –º–µ–Ω—é"
                read -p "–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è..."
                ;;
            7)
                clear
                echo "üì• –£–°–¢–ê–ù–û–í–ö–ê –í–°–ï–• –ú–û–î–ï–õ–ï–ô"
                echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
                echo "–ë—É–¥—É—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã 5 –º–æ–¥–µ–ª–µ–π:"
                echo "1. deepseek-coder:1.3b"
                echo "2. deepseek-coder:6.7b"
                echo "3. qwen2.5-coder:7b"
                echo "4. codellama:7b"
                echo "5. codestral:latest"
                echo ""
                echo "‚ö†Ô∏è  –≠—Ç–æ –∑–∞–π–º—ë—Ç –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ –º–µ—Å—Ç–∞ (~20 –ì–ë)"
                echo ""
                read -p "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å? (y/n): " -n 1 -r
                echo
                if [[ $REPLY =~ ^[Yy]$ ]]; then
                    install_model "deepseek-coder:1.3b"
                    install_model "deepseek-coder:6.7b"
                    install_model "qwen2.5-coder:7b"
                    install_model "codellama:7b"
                    install_model "codestral:latest"
                    echo "‚úÖ –í—Å–µ –º–æ–¥–µ–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã!"
                    read -p "–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è..."
                fi
                ;;
            8)
                clear
                echo "üóëÔ∏è  –£–î–ê–õ–ï–ù–ò–ï –ú–û–î–ï–õ–ò"
                echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
                echo "–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏:"
                ollama list
                echo ""
                read -p "–í–≤–µ–¥–∏—Ç–µ –∏–º—è –º–æ–¥–µ–ª–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è: " model_to_remove
                if [ -n "$model_to_remove" ]; then
                    echo "–£–¥–∞–ª—è—é $model_to_remove..."
                    ollama rm "$model_to_remove"
                    echo "‚úÖ –ú–æ–¥–µ–ª—å —É–¥–∞–ª–µ–Ω–∞"
                fi
                read -p "–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è..."
                ;;
            9)
                ./check-system.sh
                read -p "–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è..."
                ;;
            0)
                echo "üëã –î–æ —Å–≤–∏–¥–∞–Ω–∏—è!"
                exit 0
                ;;
            *)
                echo "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä!"
                sleep 1
                ;;
        esac
    done
}

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ª–∏ Ollama
if ! command -v ollama &> /dev/null; then
    echo "‚ùå Ollama –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞!"
    echo ""
    echo "–î–ª—è —Ä–∞–±–æ—Ç—ã –º–µ–Ω—é –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Ollama:"
    echo ""
    echo "1. –î–ª—è macOS/Linux:"
    echo "   curl -fsSL https://ollama.ai/install.sh | sh"
    echo ""
    echo "2. –î–ª—è Windows:"
    echo "   –°–∫–∞—á–∞–π—Ç–µ —Å https://ollama.com/download/windows"
    echo ""
    echo "–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –º–µ–Ω—é."
    exit 1
fi

# –ó–∞–ø—É—Å–∫–∞–µ–º –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
main_menu
